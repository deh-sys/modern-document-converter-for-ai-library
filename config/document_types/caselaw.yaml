# Caselaw Document Type Classifier Rules
#
# This file defines patterns for identifying legal case documents.
# Patterns are matched against extracted document text and scored.
#
# Document Type: Legal Cases (judicial opinions, court decisions)
# Examples: Trial court decisions, appellate opinions, supreme court cases
#
# Confidence Calculation:
#   - Sum all matched pattern weights
#   - Total score ranges from 0-100+
#   - Threshold determines confidence level (HIGH/MEDIUM/LOW)

document_type: caselaw

# Pattern Matching Rules
# Each pattern contributes weight to the total confidence score
patterns:
  # ========================================================================
  # STRONG INDICATORS (High Weight)
  # ========================================================================

  - pattern: '\b\w+\s+v\.\s+\w+|\b\w+\s+versus\s+\w+'
    description: "Case caption with 'v.' or 'versus'"
    weight: 40
    case_sensitive: false
    notes: "Nearly universal in US case law"

  - pattern: '\d+\s+[A-Z][a-z]+\.?\s+(?:App\.\s+)?(?:2d|3d)?\s*\d+'
    description: "Reporter citation format (e.g., '328 Ga. App. 524', '759 S.E.2d 654')"
    weight: 35
    case_sensitive: false
    notes: "Standard legal citation format"

  # ========================================================================
  # MEDIUM INDICATORS (Moderate Weight)
  # ========================================================================

  - pattern: 'Court of Appeals|Supreme Court|District Court|Circuit Court|Superior Court|Appellate Court'
    description: "Court name"
    weight: 20
    case_sensitive: false

  - pattern: '\b(?:LEXIS|Westlaw|WL\s+\d+|West\s+Law)\b'
    description: "Legal database citation"
    weight: 15
    case_sensitive: false
    notes: "Common in published opinions"

  - pattern: '\b(?:Plaintiff|Defendant|Appellant|Appellee|Petitioner|Respondent)\b'
    description: "Party designation"
    weight: 10
    case_sensitive: false

  - pattern: '(?:Decided|Filed|Argued).*\d{4}'
    description: "Decision date notation"
    weight: 10
    case_sensitive: false
    notes: "Format: 'Decided July 3, 2014' or 'Filed: October 9, 2024'"

  # ========================================================================
  # WEAK INDICATORS (Low Weight)
  # ========================================================================

  - pattern: '\b(?:Opinion|Judgment|ORDER|MOTION|Memorandum|Per Curiam)\b'
    description: "Legal procedural terms"
    weight: 5
    case_sensitive: true
    notes: "Common but not exclusive to caselaw"

  - pattern: '\b(?:affirm|reverse|remand|vacate|dismiss)(?:ed|ing)?\b'
    description: "Judicial action verbs"
    weight: 5
    case_sensitive: false

  - pattern: 'Case\s+No\.|Docket\s+No\.|Civil\s+Action\s+No\.'
    description: "Case/docket number"
    weight: 5
    case_sensitive: false

  - pattern: '\bJ\.,\s+(?:concurring|dissenting|delivering the opinion)'
    description: "Judge attribution"
    weight: 5
    case_sensitive: false
    notes: "Format: 'Smith, J., concurring'"

  - pattern: 'This case comes before (the court|us)'
    description: "Procedural history opening"
    weight: 3
    case_sensitive: false

  # ========================================================================
  # NEGATIVE INDICATORS (Reduce score)
  # ========================================================================

  - pattern: '\b(?:Section|§)\s+\d+|\bU\.S\.C\.|United States Code'
    description: "Statutory citation (suggests statute, not case)"
    weight: -10
    case_sensitive: false
    notes: "Negative weight - cases cite statutes but statutes are primary source"

# Confidence Thresholds
# Map numeric scores to confidence levels
confidence_thresholds:
  high: 60      # Score >= 60 → HIGH confidence
  medium: 30    # Score >= 30 → MEDIUM confidence
  low: 10       # Score >= 10 → LOW confidence
                # Score < 10  → Too low, return UNKNOWN

# ============================================================================
# EXTRACTION RULES
# ============================================================================
#
# Patterns for extracting structured metadata from caselaw documents.
# These are separate from classification patterns above.
#
# Each extractor attempts to find specific metadata fields using regex.
# Priority determines which pattern to try first (higher = first).
# Confidence indicates reliability of the extraction.

extraction_rules:
  # ==========================================================================
  # CASE NAME EXTRACTION
  # ==========================================================================
  case_name:
    - pattern: '([A-Z][A-Za-z\s,\.&''\-\(\)]+?)\s+v\.?\s+([A-Za-z\s,\.&''\-\(\)]+?)(?:\n|$)'
      description: "Case caption with 'v.' pattern (multi-line aware)"
      priority: 1
      confidence: HIGH
      captures:
        plaintiff:
          group: 1
          cleanup_patterns:
            - ',?\s*Petitioners?'
            - ',?\s*Plaintiffs?'
            - ',?\s*Appellants?'
            - ',?\s*et\s+al\.?'
        defendant:
          group: 2
          cleanup_patterns:
            - ',?\s*Respondents?'
            - ',?\s*Defendants?'
            - ',?\s*Appellees?'
            - ',?\s*et\s+al\.?'
      notes: "Extract both parties, then join with ' v. '"

  # ==========================================================================
  # DATE EXTRACTION
  # ==========================================================================
  date:
    - pattern: '([A-Z][a-z]+\s+\d{1,2},\s+(\d{4})),?\s+Decided'
      description: "Decided date (reverse format)"
      priority: 1
      confidence: HIGH
      captures:
        full_date:
          group: 1
        year:
          group: 2
      notes: "Format: 'July 3, 2014, Decided'"

    - pattern: 'Decided:\s*([A-Z][a-z]+\s+\d{1,2},\s+(\d{4}))'
      description: "Decided date (colon format)"
      priority: 2
      confidence: HIGH
      captures:
        full_date:
          group: 1
        year:
          group: 2
      notes: "Format: 'Decided: July 3, 2014'"

    - pattern: 'Filed:\s*([A-Z][a-z]+\s+\d{1,2},\s+(\d{4}))'
      description: "Filed date (fallback)"
      priority: 3
      confidence: HIGH
      captures:
        full_date:
          group: 1
        year:
          group: 2

    - pattern: 'Argued:\s*([A-Z][a-z]+\s+\d{1,2},\s+(\d{4}))'
      description: "Argued date (lower priority)"
      priority: 4
      confidence: MEDIUM
      captures:
        full_date:
          group: 1
        year:
          group: 2

    - pattern: '([A-Z][a-z]+\s+\d{1,2},\s+(\d{4}))'
      description: "Any date format (fallback)"
      priority: 5
      confidence: MEDIUM
      captures:
        full_date:
          group: 1
        year:
          group: 2
      notes: "Matches any 'Month Day, Year' format"

  # ==========================================================================
  # COURT EXTRACTION
  # ==========================================================================
  court:
    - pattern: 'Court of Appeals of ([A-Za-z]+)(?:\s|$)'
      description: "State Court of Appeals"
      priority: 1
      confidence: HIGH
      captures:
        state:
          group: 1
      notes: "Format: 'Court of Appeals of Georgia'"

    - pattern: 'Supreme Court of ([A-Za-z\s]+)'
      description: "State Supreme Court"
      priority: 1
      confidence: HIGH
      captures:
        state:
          group: 1

    - pattern: 'United States Court of Appeals(?:,?\s+|\s+for\s+the\s+)((?:First|Second|Third|Fourth|Fifth|Sixth|Seventh|Eighth|Ninth|Tenth|Eleventh|D\.?C\.|Federal)\s+Circuit)'
      description: "Federal Circuit Court of Appeals"
      priority: 1
      confidence: HIGH
      captures:
        circuit:
          group: 1

    - pattern: 'United States District Court.*?for the\s+((?:Northern|Southern|Eastern|Western)\s+District\s+of)\s+([A-Za-z\s]+?)'
      description: "Federal District Court"
      priority: 2
      confidence: HIGH
      captures:
        district:
          group: 1
        state:
          group: 2

  # ==========================================================================
  # CITATION EXTRACTION
  # ==========================================================================
  citation:
    # Georgia Reporters
    - pattern: '(\d+)\s+Ga\.\s*App\.\s+(\d+)'
      description: "Georgia Court of Appeals Reporter"
      priority: 1
      confidence: HIGH
      captures:
        volume:
          group: 1
        page:
          group: 2
      reporter: "Ga. App."
      notes: "Format: '328 Ga. App. 524'"

    - pattern: '(\d+)\s+Ga\.\s+(\d+)'
      description: "Georgia Reports (Supreme Court)"
      priority: 1
      confidence: HIGH
      captures:
        volume:
          group: 1
        page:
          group: 2
      reporter: "Ga."

    # South Eastern Reporter
    - pattern: '(\d+)\s+S\.E\.\s*2d\s+(\d+)'
      description: "South Eastern Reporter, Second Series"
      priority: 1
      confidence: HIGH
      captures:
        volume:
          group: 1
        page:
          group: 2
      reporter: "S.E.2d"

    - pattern: '(\d+)\s+S\.E\.\s*3d\s+(\d+)'
      description: "South Eastern Reporter, Third Series"
      priority: 1
      confidence: HIGH
      captures:
        volume:
          group: 1
        page:
          group: 2
      reporter: "S.E.3d"

    # Federal Reporters
    - pattern: '(\d+)\s+F\.\s*3d\s+(\d+)'
      description: "Federal Reporter, Third Series"
      priority: 1
      confidence: HIGH
      captures:
        volume:
          group: 1
        page:
          group: 2
      reporter: "F.3d"

    - pattern: '(\d+)\s+F\.\s*2d\s+(\d+)'
      description: "Federal Reporter, Second Series"
      priority: 1
      confidence: HIGH
      captures:
        volume:
          group: 1
        page:
          group: 2
      reporter: "F.2d"

    - pattern: '(\d+)\s+F\.\s*Supp\.\s*2d\s+(\d+)'
      description: "Federal Supplement, Second Series"
      priority: 2
      confidence: HIGH
      captures:
        volume:
          group: 1
        page:
          group: 2
      reporter: "F. Supp. 2d"

    - pattern: '(\d+)\s+F\.\s*Supp\.\s*3d\s+(\d+)'
      description: "Federal Supplement, Third Series"
      priority: 2
      confidence: HIGH
      captures:
        volume:
          group: 1
        page:
          group: 2
      reporter: "F. Supp. 3d"

    # U.S. Supreme Court
    - pattern: '(\d+)\s+U\.S\.\s+(\d+)'
      description: "United States Reports"
      priority: 1
      confidence: HIGH
      captures:
        volume:
          group: 1
        page:
          group: 2
      reporter: "U.S."

    - pattern: '(\d+)\s+S\.\s*Ct\.\s+(\d+)'
      description: "Supreme Court Reporter"
      priority: 1
      confidence: HIGH
      captures:
        volume:
          group: 1
        page:
          group: 2
      reporter: "S. Ct."

# Metadata
classifier_version: "1.0"
last_updated: "2025-11-29"
notes: |
  Based on analysis of real case documents from LexisNexis and Westlaw.
  Patterns tested against Georgia Court of Appeals opinions and federal district court cases.

  Tuning:
    - Strong indicators (v., reporter citations) = 75 points combined
    - Medium indicators (court names, party designations) = 55 points combined
    - Multiple weak indicators can push to MEDIUM confidence
    - Negative indicators (statutory citations) reduce false positives

# ============================================================================
# TEXT CLEANING RULES
# ============================================================================
# Applied during convert_step to remove Lexis/Westlaw noise and format headings
# for AI/RAG consumption

cleaning_rules:
  description: "Document-specific cleaning patterns for caselaw text"

  # Patterns to delete entirely (noise removal)
  # These are platform-specific headers/footers that add no semantic value
  noise_patterns:
    - pattern: '^As of:\s+[A-Za-z]+\s+\d{1,2},\s+\d{4}.*$'
      description: "Lexis timestamp headers (e.g., 'As of: November 28, 2024 8:48 PM Z')"
      action: delete_line

    - pattern: '^Page\s+\d+\s+of\s+\d+\s*$'
      description: "Page footer numbers from Lexis/Westlaw PDFs"
      action: delete_line

    - pattern: '^Load Date:.*$'
      description: "Lexis load date metadata"
      action: delete_line

    - pattern: '^End of Document\s*$'
      description: "Lexis document terminator"
      action: delete_line

    - pattern: '^\|\s*$'
      description: "Stray table borders or dividers"
      action: delete_line

    - pattern: '^\s*\*+\s*$'
      description: "Asterisk separators used in some opinions"
      action: delete_line

  # Patterns to convert to markdown headings
  # These help structure the document for better AI comprehension
  heading_patterns:
    - pattern: '^Opinion by:\s*(.+)$'
      description: "Opinion author attribution (e.g., 'Opinion by: LAGRUA')"
      action: prepend_markdown
      markdown_prefix: '## '

    - pattern: '^([A-Z][A-Z0-9\s\W]{3,100})$'
      description: "All-caps section headings (OPINION, BACKGROUND, ANALYSIS, CONCLUSION)"
      action: prepend_markdown
      markdown_prefix: '## '

    - pattern: '^\d+\.\s+(.+)$'
      description: "Numbered sections (1. Background, 2. Analysis, 3. Conclusion)"
      action: prepend_markdown
      markdown_prefix: '### '

    - pattern: '^[IVX]+\.\s+(.+)$'
      description: "Roman numeral sections (I. Introduction, II. Facts, III. Law)"
      action: prepend_markdown
      markdown_prefix: '### '

  # Configuration
  apply_order:
    - noise_patterns  # Remove noise first
    - heading_patterns  # Then format headings

  preserve_line_breaks: true  # Keep paragraph structure intact
